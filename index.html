<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Team Project Tracking - Grapes Worldwide</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0A0F11; --bg-medium: #141A1D; --board-bg: rgba(255, 255, 255, 0.03);
            --column-bg: rgba(255, 255, 255, 0.015); --card-bg: rgba(255, 255, 255, 0.005);
            --border-color: rgba(70, 100, 130, 0.1); --text-color: #D3DBE0; --text-muted: rgba(211, 219, 224, 0.7);
            --accent-main: #5C95D6; --priority-high: #E57373; --priority-medium: #FFB74D;
            --priority-low: #81C784; --status-overdue: #E57373;
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-size-base: 14px; --font-size-lg: 16px; --font-size-sm: 12px;
            --font-weight-normal: 400; --font-weight-medium: 500; --font-weight-bold: 600;
            --card-hover: rgba(255, 255, 255, 0.02);
            --column-header-bg: rgba(92, 149, 214, 0.1);
            --scrollbar-thumb: rgba(92, 149, 214, 0.3);
        }
        [data-theme="light"] {
            --bg-dark: #F4F7F9; --bg-medium: #FFFFFF; --board-bg: rgba(255, 255, 255, 0.8);
            --column-bg: rgba(244, 247, 249, 0.9); --card-bg: #FFFFFF; --border-color: #DDE4E8;
            --text-color: #2D3748; --text-muted: #718096; --accent-main: #3182CE;
            --card-hover: rgba(0, 0, 0, 0.02);
            --column-header-bg: rgba(49, 130, 206, 0.1);
            --scrollbar-thumb: rgba(49, 130, 206, 0.4);
        }

        body { 
            margin: 0; padding: 0; font-family: var(--font-family); font-size: var(--font-size-base); 
            font-weight: var(--font-weight-normal); color: var(--text-color); 
            background: linear-gradient(145deg, var(--bg-dark), var(--bg-medium)); 
            min-height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; 
        }

        .main-layout-container { display: flex; gap: 40px; width: 95%; max-width: 1700px; padding: 30px 0; }

        .project-board-container { 
            flex-grow: 1; background: var(--board-bg); border: 1px solid var(--border-color); 
            border-radius: 20px; backdrop-filter: blur(15px); padding: 25px; display: flex; 
            flex-direction: column; min-height: 80vh; max-height: 85vh; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); 
        }

        .board-header { 
            display: flex; justify-content: space-between; align-items: flex-end; 
            margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--border-color); 
        }

        .header-title h2 { 
            font-size: 2em; font-weight: var(--font-weight-bold); color: var(--accent-main); 
            margin: 0 0 4px 0; line-height: 1.2; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); 
        }

        .header-title .credit { color: var(--text-muted); font-size: 0.8em; opacity: 0.6; }

        .header-controls { display: flex; align-items: center; gap: 15px; }

        .last-updated { 
            color: var(--text-muted); font-size: 0.8em; white-space: nowrap; padding: 8px 12px; 
            background: rgba(255, 255, 255, 0.02); border-radius: 8px; border: 1px solid var(--border-color); 
        }

        .board-controls { 
            display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 20px; 
            padding: 15px; background: rgba(0,0,0,0.1); border-radius: 12px; border: 1px solid var(--border-color); 
        }

        .board-controls input, .board-controls select, .board-controls button { 
            padding: 10px 14px; font-size: 0.9em; background: var(--card-bg); color: var(--text-color); 
            border: 1px solid var(--border-color); border-radius: 8px; transition: all 0.2s ease; 
        }

        .board-controls input:focus, .board-controls select:focus { 
            outline: none; border-color: var(--accent-main); 
            box-shadow: 0 0 0 2px rgba(92, 149, 214, 0.2); 
        }

        #search-bar { flex-grow: 1; min-width: 150px; }
        #search-bar::placeholder { color: var(--text-muted); }

        #theme-toggle { 
            cursor: pointer; font-size: 1.2em; padding: 8px 12px; 
            background-color: transparent; transition: all 0.2s ease; 
        }
        #theme-toggle:hover { background-color: var(--card-hover); }

        .board-columns { 
            display: flex; gap: 20px; flex-grow: 1; overflow-x: auto; 
            padding-bottom: 10px; min-height: 0; 
        }

        .column { 
            flex: 1; min-width: 300px; max-width: 350px; background: var(--column-bg); 
            border: 1px solid var(--border-color); border-radius: 12px; padding: 0; 
            display: flex; flex-direction: column; gap: 0; 
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05); 
        }

        .column h3 { 
            font-size: 1.3em; font-weight: var(--font-weight-medium); margin: 0; 
            color: var(--accent-main); background: var(--column-header-bg); 
            padding: 18px 20px; border-radius: 12px 12px 0 0; border-bottom: 2px solid var(--border-color); 
            display: flex; justify-content: space-between; align-items: center; backdrop-filter: blur(10px); 
        }

        .column-count { 
            font-size: 0.8em; color: var(--text-muted); background: rgba(255, 255, 255, 0.1); 
            padding: 4px 8px; border-radius: 12px; 
        }

        .column-content { 
            padding: 15px; display: flex; flex-direction: column; gap: 15px; 
            flex-grow: 1; overflow-y: auto; 
        }

        .project-card { 
            background: var(--card-bg); border: 1px solid var(--border-color); 
            border-left: 4px solid var(--accent-main); border-radius: 10px; 
            padding: 16px 18px; display: flex; flex-direction: column; gap: 12px; 
            transition: all 0.3s ease; cursor: pointer; position: relative; overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .project-card::before { 
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, transparent 50%); 
            opacity: 0; transition: opacity 0.3s ease; pointer-events: none; 
        }

        .project-card:hover { 
            transform: translateY(-2px) scale(1.01); 
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2); 
            background: var(--card-hover); 
            border-left-color: #7fb3d3;
        }

        .project-card:hover::before { opacity: 1; }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 8px; }

        .project-card p { 
            font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); 
            margin: 0; line-height: 1.3; 
        }

        .card-type-tag { 
            background: rgba(92, 149, 214, 0.15); color: var(--accent-main); 
            padding: 4px 10px; border-radius: 8px; font-size: 0.75em; 
            font-weight: var(--font-weight-medium); white-space: nowrap; 
            border: 1px solid rgba(92, 149, 214, 0.2); 
        }

        .project-card small { 
            font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); 
            color: var(--text-muted); 
        }

        .assignee-container {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .assignee-avatars {
            display: flex;
            gap: 4px;
        }

        .avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-main), #7fb3d3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
            border: 2px solid var(--card-bg);
            position: relative;
        }

        .avatar:not(:first-child) {
            margin-left: -8px;
        }

        .assignee-text { 
            font-size: 0.8em;
            color: var(--text-muted);
        }

        .card-footer { 
            display: flex; justify-content: space-between; align-items: center; margin-top: 8px; 
        }

        .priority-tag { 
            padding: 4px 12px; border-radius: 16px; font-size: 0.75em; 
            font-weight: var(--font-weight-bold); color: #fff; text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }

        .priority-high { background: linear-gradient(135deg, var(--priority-high), #d32f2f); }
        .priority-medium { background: linear-gradient(135deg, var(--priority-medium), #f57c00); }
        .priority-low { background: linear-gradient(135deg, var(--priority-low), #388e3c); }

        .eta-text { 
            font-size: 0.8em; font-weight: var(--font-weight-medium); 
            padding: 4px 8px; background: rgba(255, 255, 255, 0.05); border-radius: 6px; 
        }

        .project-card.overdue .eta-text { 
            color: var(--status-overdue); font-weight: var(--font-weight-bold); 
            background: rgba(229, 115, 115, 0.15); 
        }

        .progress-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar-container { 
            flex: 1;
            height: 8px; 
            background-color: rgba(120, 120, 120, 0.15); 
            border-radius: 4px; 
            overflow: hidden; 
            position: relative; 
        }

        .progress-bar { 
            height: 100%; 
            background: linear-gradient(90deg, var(--accent-main), #7fb3d3); 
            border-radius: 4px; 
            transition: width 0.5s ease; 
            position: relative; 
        }

        .progress-bar::after { 
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent); 
            animation: shimmer 2s infinite; 
        }

        .progress-percentage {
            font-size: 0.75em;
            color: var(--text-muted);
            font-weight: bold;
            min-width: 32px;
            text-align: right;
        }

        @keyframes shimmer { 
            0% { transform: translateX(-100%); } 
            100% { transform: translateX(100%); } 
        }

        .side-panels { width: 250px; display: flex; flex-direction: column; gap: 30px; }

        .panel-group { 
            background: var(--column-bg); border: 1px solid var(--border-color); 
            border-radius: 15px; backdrop-filter: blur(10px); padding: 0; 
            display: flex; flex-direction: column; gap: 0; flex-grow: 1; min-height: 0; 
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05); 
        }

        .panel-group h3 { 
            font-size: 1.4em; font-weight: var(--font-weight-bold); color: var(--accent-main); 
            text-align: center; margin: 0; background: var(--column-header-bg); 
            padding: 18px 20px; border-radius: 15px 15px 0 0; border-bottom: 2px solid var(--border-color); 
        }

        #company-list { max-height: 400px; overflow-y: auto; padding: 15px; padding-right: 10px; }

        .panel-card { 
            background: var(--card-bg); border: 1px solid var(--border-color); 
            border-radius: 8px; padding: 12px 20px; font-size: 1em; 
            font-weight: var(--font-weight-medium); color: var(--text-muted); 
            text-align: center; cursor: pointer; transition: all 0.3s ease; margin-bottom: 8px; 
        }

        .panel-card:hover { 
            background: var(--card-hover); transform: translateX(4px); 
        }

        .panel-card.active { 
            border-color: var(--accent-main); color: var(--accent-main); 
            background: rgba(92, 149, 214, 0.1); transform: translateX(4px); 
        }

        .empty-column { 
            display: flex; align-items: center; justify-content: center; 
            color: var(--text-muted); font-style: italic; padding: 40px 20px; opacity: 0.6; 
        }

        /* Custom Scrollbars */
        .column-content::-webkit-scrollbar, #company-list::-webkit-scrollbar { width: 8px; }
        .column-content::-webkit-scrollbar-track, #company-list::-webkit-scrollbar-track { background: transparent; }
        .column-content::-webkit-scrollbar-thumb, #company-list::-webkit-scrollbar-thumb { 
            background-color: var(--scrollbar-thumb); border-radius: 4px; 
        }

        /* Quick Actions */
        .quick-actions {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .quick-action-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-main), #7fb3d3);
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quick-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* Enhanced Type Icons */
        .card-type-tag.type-video::before {
            content: '🎥 ';
        }

        .card-type-tag.type-static::before {
            content: '🖼️ ';
        }

        .card-type-tag.type-project::before {
            content: '📋 ';
        }

        @media (max-width: 1300px) { 
            body { overflow-y: auto; } 
            .main-layout-container { flex-direction: column; align-items: center; padding: 20px; } 
            .project-board-container, .side-panels { width: 95%; max-height: none; } 
            .side-panels { flex-direction: row; } 
            .quick-actions { bottom: 20px; right: 20px; }
        }

        @media (max-width: 768px) { 
            .board-columns { flex-direction: column; overflow-x: hidden; } 
            .column { max-width: 100%; } 
            .quick-actions { 
                flex-direction: row; 
                bottom: 20px; 
                right: 50%; 
                transform: translateX(50%); 
            }
        }
    </style>
</head>
<body>
    <div class="main-layout-container">
        <div class="project-board-container">
            <header class="board-header">
                <div class="header-title">
                    <h2>3D Team Project Tracking <br> Grapes Worldwide</h2>
                    <small class="credit">By Raza</small>
                </div>
                <div class="header-controls">
                    <small class="last-updated">📅 Last Updated: 2024-06-28</small>
                    <button id="theme-toggle" title="Toggle Theme">🌓</button>
                </div>
            </header>
            <div class="board-controls">
                <input type="text" id="search-bar" placeholder="🔍 Search projects...">
                <select id="filter-assignee"></select>
                <select id="filter-priority"></select>
                <select id="sort-by">
                    <option value="eta_asc">Sort by ETA (Asc)</option>
                    <option value="eta_desc">Sort by ETA (Desc)</option>
                    <option value="name_asc">Sort by Name (A-Z)</option>
                    <option value="priority">Sort by Priority</option>
                    <option value="progress">Sort by Progress</option>
                </select>
            </div>
            <div class="board-columns" id="project-board-columns"></div>
        </div>
        <div class="side-panels">
            <div class="panel-group">
                <h3>Companies</h3>
                <div id="company-list"></div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="quick-action-btn" id="scroll-to-top" title="Scroll to Top">↑</button>
        <button class="quick-action-btn" id="refresh-data" title="Refresh Data">🔄</button>
    </div>

    <script>
        const projectData = [
            {
                "id": "p13",
                "company": "Ancestar",
                "name": "4 3d Videos Skin",
                "stage": "Closed",
                "assigned": [
                    "Shrey",
                    "Nimish"
                ],
                "eta": "2025-06-27",
                "progress": 100,
                "status": "closed",
                "priority": "Low",
                "type": "Video"
            },
            {
                "id": "p11",
                "company": "Bikano",
                "name": "Bikano around the world creative",
                "stage": "Closed",
                "assigned": [
                    "Sumit"
                ],
                "eta": "2025-06-30",
                "progress": 100,
                "status": "closed",
                "priority": "High",
                "type": "Static"
            },
            {
                "id": "p4",
                "company": "Dabur",
                "name": "Gulbari CGI video",
                "stage": "Feedback",
                "assigned": [
                    "Nimish",
                    "Raza"
                ],
                "eta": "2025-06-30",
                "progress": 90,
                "status": "active",
                "priority": "High",
                "type": "Video"
            },
            {
                "id": "p17",
                "company": "Manfor",
                "name": "Myra intro video",
                "stage": "Work in Progress",
                "assigned": [
                    "Ally"
                ],
                "eta": "2025-06-30",
                "progress": 85,
                "status": "active",
                "priority": "Medium",
                "type": "Video"
            },
            {
                "id": "p2",
                "company": "MPP",
                "name": "Monsoon 3d Video",
                "stage": "Storyboard",
                "assigned": [
                    "Nimish",
                    "Raza"
                ],
                "eta": "2025-06-30",
                "progress": 20,
                "status": "active",
                "priority": "Medium",
                "type": "Video"
            },
            {
                "id": "p3",
                "company": "MPP",
                "name": "Pokochan Birthday",
                "stage": "Work in Progress",
                "assigned": [
                    "Raza",
                    "Vignesh",
                    "Sumit"
                ],
                "eta": "2025-07-02",
                "progress": 80,
                "status": "active",
                "priority": "High",
                "type": "Video"
            },
            {
                "id": "p1",
                "company": "MPP",
                "name": "Travel CGI Video",
                "stage": "Work in Progress",
                "assigned": [
                    "Shrey",
                    "Nimish"
                ],
                "eta": "2025-07-01",
                "progress": 75,
                "status": "active",
                "priority": "High",
                "type": "Video"
            },
            {
                "id": "p16",
                "company": "Munafa",
                "name": "AI Video Generation",
                "stage": "Work in Progress",
                "assigned": [
                    "Krithik",
                    "Kuleen"
                ],
                "eta": "2025-07-12",
                "progress": 50,
                "status": "active",
                "priority": "High",
                "type": "Video"
            },
            {
                "id": "p14",
                "company": "Safco",
                "name": "Safco CGI videos Building #1",
                "stage": "Concept",
                "assigned": [
                    "Nimish"
                ],
                "eta": "2025-07-02",
                "progress": 20,
                "status": "active",
                "priority": "Low",
                "type": "Video"
            },
            {
                "id": "p15",
                "company": "Safco",
                "name": "Safco CGI videos Building #2",
                "stage": "Concept",
                "assigned": [
                    "Nimish"
                ],
                "eta": "2025-07-02",
                "progress": 20,
                "status": "active",
                "priority": "Low",
                "type": "Video"
            },
            {
                "id": "p12",
                "company": "Vibhor",
                "name": "3d model development",
                "stage": "Work in Progress",
                "assigned": [
                    "Shrey",
                    "Nimish"
                ],
                "eta": "2025-07-02",
                "progress": 65,
                "status": "active",
                "priority": "Medium",
                "type": "Project"
            },
            {
                "id": "p9",
                "company": "Vital",
                "name": "Citrus Reveal - CGI Video",
                "stage": "Concept",
                "assigned": [
                    "Raza"
                ],
                "eta": "2025-07-04",
                "progress": 10,
                "status": "active",
                "priority": "Medium",
                "type": "Video"
            },
            {
                "id": "p8",
                "company": "Vital",
                "name": "Crush & Recycle - Static",
                "stage": "Feedback",
                "assigned": [
                    "Sumit",
                    "Nimish"
                ],
                "eta": "2025-07-02",
                "progress": 90,
                "status": "active",
                "priority": "Medium",
                "type": "Static"
            },
            {
                "id": "p6",
                "company": "Vital",
                "name": "Football Hydration - Static",
                "stage": "Work in Progress",
                "assigned": [
                    "Sumit"
                ],
                "eta": "2025-06-30",
                "progress": 60,
                "status": "active",
                "priority": "Medium",
                "type": "Static"
            },
            {
                "id": "p7",
                "company": "Vital",
                "name": "New Launch - Static",
                "stage": "Work in Progress",
                "assigned": [
                    "Sumit"
                ],
                "eta": "2025-06-30",
                "progress": 50,
                "status": "active",
                "priority": "Medium",
                "type": "Static"
            },
            {
                "id": "p5",
                "company": "Vital",
                "name": "Sandy Beach - Static",
                "stage": "Closed",
                "assigned": [
                    "Vignesh"
                ],
                "eta": "2025-06-26",
                "progress": 100,
                "status": "closed",
                "priority": "Medium",
                "type": "Static"
            },
            {
                "id": "p10",
                "company": "Vital",
                "name": "Vital riding the waves - CGI Video",
                "stage": "Concept",
                "assigned": [
                    "Nimish"
                ],
                "eta": "2025-07-03",
                "progress": 15,
                "status": "active",
                "priority": "Medium",
                "type": "Video"
            }
        ];

        const stages = ["Concept","Storyboard","Work in Progress","Feedback","Closed"];
        
        let activeFilters = { company: null, assignee: 'all', priority: 'all', search: '' };
        let sortBy = 'eta_asc';
        
        const boardColumnsDiv = document.getElementById('project-board-columns');
        const companyListDiv = document.getElementById('company-list');
        const searchBar = document.getElementById('search-bar');
        const filterAssignee = document.getElementById('filter-assignee');
        const filterPriority = document.getElementById('filter-priority');
        const sortBySelect = document.getElementById('sort-by');
        const themeToggle = document.getElementById('theme-toggle');

        function getInitials(name) {
            return name.split(' ').map(word => word[0]).join('').toUpperCase();
        }

        function getCountdownText(eta) {
            const now = new Date();
            const date = new Date(eta);
            now.setHours(0, 0, 0, 0);
            date.setHours(0, 0, 0, 0);
            const diff = Math.ceil((date - now) / (1000 * 60 * 60 * 24));
            if (isNaN(diff)) return "Invalid Date";
            if (diff === 0) return "Today";
            if (diff > 0) return `in ${diff}d`;
            return `${Math.abs(diff)}d late`;
        }

        function createAssigneeAvatars(assignees) {
            const avatarsHTML = assignees.slice(0, 3).map(name => 
                `<div class="avatar" title="${name}">${getInitials(name)}</div>`
            ).join('');
            
            const moreCount = assignees.length > 3 ? `+${assignees.length - 3}` : '';
            const assigneeText = assignees.length > 3 ? 
                `${assignees.slice(0, 2).join(', ')} & ${assignees.length - 2} more` : 
                assignees.join(', ');

            return `
                <div class="assignee-container">
                    <div class="assignee-avatars">${avatarsHTML}${moreCount ? `<div class="avatar" title="${assignees.slice(3).join(', ')}">${moreCount}</div>` : ''}</div>
                    <span class="assignee-text">${assigneeText}</span>
                </div>
            `;
        }
        
        function renderMainBoard() {
            let projectsToDisplay = projectData.filter(p => {
                const searchMatch = !activeFilters.search || 
                    p.name.toLowerCase().includes(activeFilters.search) || 
                    p.company.toLowerCase().includes(activeFilters.search) ||
                    p.assigned.some(assignee => assignee.toLowerCase().includes(activeFilters.search));
                const companyMatch = !activeFilters.company || p.company === activeFilters.company;
                const assigneeMatch = activeFilters.assignee === 'all' || p.assigned.includes(activeFilters.assignee);
                const priorityMatch = activeFilters.priority === 'all' || p.priority === activeFilters.priority;
                return searchMatch && companyMatch && assigneeMatch && priorityMatch;
            });

            projectsToDisplay.sort((a, b) => {
                switch(sortBy) {
                    case 'eta_desc': return new Date(b.eta) - new Date(a.eta);
                    case 'name_asc': return a.name.localeCompare(b.name);
                    case 'priority': 
                        const priorityOrder = { 'High': 3, 'Medium': 2, 'Low': 1 };
                        return priorityOrder[b.priority] - priorityOrder[a.priority];
                    case 'progress': return b.progress - a.progress;
                    default: return new Date(a.eta) - new Date(b.eta);
                }
            });

            boardColumnsDiv.innerHTML = '';
            stages.forEach(stage => {
                const columnDiv = document.createElement('div');
                columnDiv.className = 'column';
                const projectsInStage = projectsToDisplay.filter(p => 
                    (stage === 'Closed') ? p.status === 'closed' : (p.stage === stage && p.status === 'active')
                );
                
                columnDiv.innerHTML = `
                    <h3>
                        <span>${stage}</span>
                        <span class="column-count">${projectsInStage.length}</span>
                    </h3>
                    <div class="column-content"></div>
                `;
                
                const columnContent = columnDiv.querySelector('.column-content');
                
                if (projectsInStage.length === 0) {
                    columnContent.innerHTML = '<div class="empty-column">No projects in this stage</div>';
                } else {
                    projectsInStage.forEach(project => columnContent.appendChild(createProjectCard(project)));
                }
                
                boardColumnsDiv.appendChild(columnDiv);
            });
        }

        function createProjectCard(project) {
            const card = document.createElement('div');
            card.className = 'project-card';
            card.dataset.projectId = project.id;
            
            const today = new Date();
            today.setHours(0,0,0,0);
            if (new Date(project.eta) < today && project.status !== 'closed') {
                card.classList.add('overdue');
            }

            const type = project.type || 'Project';
            const typeClass = `type-${type.toLowerCase()}`;
            
            card.innerHTML = `
                <div class="card-header">
                    <p>${project.name}</p>
                    <span class="card-type-tag ${typeClass}">${type}</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: ${project.progress}%;"></div>
                    </div>
                    <span class="progress-percentage">${project.progress}%</span>
                </div>
                ${createAssigneeAvatars(project.assigned)}
                <div class="card-footer">
                    <small class="eta-text">ETA: ${getCountdownText(project.eta)}</small>
                    <span class="priority-tag priority-${project.priority.toLowerCase()}">${project.priority}</span>
                </div>
            `;

            // Add click handler for card details
            card.addEventListener('click', () => showProjectDetails(project));
            
            return card;
        }

        function showProjectDetails(project) {
            // Simple alert for now - you can enhance this later
            const details = `
Project: ${project.name}
Company: ${project.company}
Stage: ${project.stage}
Progress: ${project.progress}%
Priority: ${project.priority}
Assigned to: ${project.assigned.join(', ')}
ETA: ${project.eta}
            `;
            alert(details);
        }
        
        function renderCompanies() {
            companyListDiv.innerHTML = ''; 
            
            const allCard = document.createElement('div');
            allCard.className = 'panel-card company-card active';
            allCard.textContent = 'All Companies';
            allCard.addEventListener('click', () => selectCompany(null));
            companyListDiv.appendChild(allCard);
            
            const uniqueCompanies = [...new Set(projectData.map(p => p.company))].sort();
            uniqueCompanies.forEach(company => {
                const projectCount = projectData.filter(p => p.company === company).length;
                const card = document.createElement('div');
                card.className = 'panel-card company-card';
                card.innerHTML = `${company} <small>(${projectCount})</small>`;
                card.dataset.companyName = company;
                card.addEventListener('click', () => selectCompany(company));
                companyListDiv.appendChild(card);
            });
        }

        function selectCompany(companyName) {
            activeFilters.company = companyName;
            document.querySelectorAll('.company-card').forEach(c => c.classList.remove('active'));
            const activeCard = companyName ? 
                document.querySelector(`.company-card[data-company-name="${companyName}"]`) : 
                document.querySelector('.company-card:not([data-company-name])');
            if (activeCard) activeCard.classList.add('active');
            renderMainBoard();
        }

        function populateFilters() {
            const assignees = [...new Set(projectData.flatMap(p => p.assigned))].sort();
            filterAssignee.innerHTML = '<option value="all">All Assignees</option>';
            assignees.forEach(a => {
                const projectCount = projectData.filter(p => p.assigned.includes(a)).length;
                filterAssignee.innerHTML += `<option value="${a}">${a} (${projectCount})</option>`;
            });
            
            const priorities = ['High', 'Medium', 'Low'];
            filterPriority.innerHTML = '<option value="all">All Priorities</option>';
            priorities.forEach(p => {
                const projectCount = projectData.filter(proj => proj.priority === p).length;
                filterPriority.innerHTML += `<option value="${p}">${p} (${projectCount})</option>`;
            });
        }

        function refreshData() {
            // Simulate data refresh with animation
            const refreshBtn = document.getElementById('refresh-data');
            refreshBtn.style.transform = 'rotate(360deg)';
            
            setTimeout(() => {
                renderMainBoard();
                renderCompanies();
                populateFilters();
                refreshBtn.style.transform = 'rotate(0deg)';
            }, 500);
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Enhanced keyboard shortcuts
        function handleKeyboardShortcuts(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'f':
                        e.preventDefault();
                        searchBar.focus();
                        break;
                    case 'r':
                        e.preventDefault();
                        refreshData();
                        break;
                }
            }
            
            if (e.key === 'Escape') {
                searchBar.blur();
                document.activeElement.blur();
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved theme
            const savedTheme = localStorage.getItem('project-tracker-theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            // Initial render
            renderMainBoard(); 
            renderCompanies(); 
            populateFilters();
            
            // Event listeners
            searchBar.addEventListener('input', e => { 
                activeFilters.search = e.target.value.toLowerCase(); 
                renderMainBoard(); 
            });
            
            filterAssignee.addEventListener('change', e => { 
                activeFilters.assignee = e.target.value; 
                renderMainBoard(); 
            });
            
            filterPriority.addEventListener('change', e => { 
                activeFilters.priority = e.target.value; 
                renderMainBoard(); 
            });
            
            sortBySelect.addEventListener('change', e => { 
                sortBy = e.target.value; 
                renderMainBoard(); 
            });
            
            themeToggle.addEventListener('click', () => {
                const newTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('project-tracker-theme', newTheme);
            });

            // Quick action buttons
            document.getElementById('scroll-to-top').addEventListener('click', scrollToTop);
            document.getElementById('refresh-data').addEventListener('click', refreshData);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
            
            // Auto-refresh every 5 minutes (optional)
            setInterval(() => {
                const lastRefresh = localStorage.getItem('last-refresh');
                const now = Date.now();
                if (!lastRefresh || now - parseInt(lastRefresh) > 300000) { // 5 minutes
                    refreshData();
                    localStorage.setItem('last-refresh', now.toString());
                }
            }, 60000); // Check every minute
        });
    </script>
</body>
</html>
